---
title: "まとめ"
sidebar_position: 33
kiteTranslationSourceHash: e9317f9dbd19894328c7118f601cd34c
---

## AWS Load Balancer Controllerの理解

AWS Load Balancer ControllerがApplication Load Balancer（ALB）とどのように連携するかについて学んだことを復習しましょう。このアーキテクチャを理解することで、将来のトラブルシューティングに役立ちます。

### コアコンポーネントとフロー

1. **コントローラーの動作**
   * コントローラーはKubernetes APIサーバーからのイングレスイベントを継続的に監視します
   * 対象となるイングレスリソースを検出すると、対応するAWSリソースの作成を開始します
   * コントローラーはこれらのAWSリソースのライフサイクル全体を管理します

2. **Application Load Balancer（ALB）**
   * 各イングレスリソースに対してALBが作成されます
   * インターネット向けまたは内部向けとして構成可能
   * サブネットの配置はアノテーションを通じて制御されます
   * 作成と管理には適切なIAM権限が必要です

3. **ターゲットグループ**
   * イングレスで定義された各Kubernetesサービスに対して作成されます
   * ポッドを直接登録するためのIPモードターゲティングをサポート
   * ヘルスチェックはアノテーションで設定可能
   * 異なるサービスに対して複数のターゲットグループを使用可能

4. **リスナー**
   * イングレスアノテーションで指定された各ポートに対して作成されます
   * 指定されていない場合は標準ポート（80/443）をデフォルトとします
   * SSL/TLS証明書のアタッチメントをサポート
   * HTTP/HTTPSトラフィックに対して設定可能

5. **ルール**
   * イングレスリソースのパス指定に基づいて作成されます
   * トラフィックを適切なターゲットグループに誘導します
   * パスベースとホストベースのルーティングをサポート
   * 複雑なルーティングシナリオのために優先順位付け可能

### 一般的なトラブルシューティング領域

このモジュールを通じて、いくつかの典型的な問題に遭遇し、修正しました：

1. **サブネット設定**
   * パブリックサブネットには`kubernetes.io/role/elb=1`タグが必要
   * プライベートサブネットには`kubernetes.io/role/internal-elb=1`タグが必要
   * サブネットはルートテーブルに適切に関連付けられている必要があります

2. **IAMアクセス許可**
   * サービスアカウントには適切なIAMロールが必要
   * ロールにはALB操作に必要な権限が必要
   * 一般的な権限には、ロードバランサーとターゲットグループの作成/変更などがあります

3. **サービス設定**
   * サービスセレクターはポッドラベルと完全に一致する必要があります
   * サービスポートはコンテナポートと整合している必要があります
   * サービス名はイングレスバックエンド設定と一致する必要があります

### ベストプラクティス

AWS Load Balancer Controllerを使用する際の注意点：

* インターネット向けALBを作成する前に、常にサブネットタグを確認する
* ALBの動作を制御するために明示的なアノテーションを使用する
* トラブルシューティングのためにコントローラーログを監視する
* サービスエンドポイントの登録を確認する
* サービスとポッドには意味のあるラベルを使用する
* カスタム設定をドキュメント化する

:::tip
[AWS Load Balancer Controllerのドキュメント](https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/)は、高度な設定やトラブルシューティングのための優れたリソースです。
:::


