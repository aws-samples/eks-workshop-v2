apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
configMapGenerator:
- name: provisioner-vars
  namespace: other
  env: config.properties
  options:
    disableNameSuffixHash: true
replacements:
- source:
    kind: ConfigMap
    name: provisioner-vars
    version: v1
    namespace: other
    fieldPath: data.EKS_CLUSTER_NAME
  targets:
  - select:
      kind: AWSNodeTemplate
      name: default
    fieldPaths:
    - spec.subnetSelector.[karpenter.sh/discovery]
    - spec.securityGroupSelector.[karpenter.sh/discovery]
- source:
    kind: ConfigMap
    metadata:
      name: provisioner-vars
      vesion: v1
      namespace: aiml
      fieldpath: data.AIML_DL_IMAGE
  targets:
  - select:
      kind: Pod
      name: inference
    fieldPaths:
      - spec.containers.image
- source:
    kind: ConfigMap
    name: provisioner-vars
    version: v1
    namespace: aiml
    fieldPath: data.AIML_NEURON_ROLE_ARN
  targets:
    - select:
        kind: ServiceAccount
        name: inference
      fieldPaths:
        - metadata.annotations.[eks.amazonaws.com/role-arn]
    
resources:
- provisioner.yaml
- inference.yaml
- serviceaccount.yaml